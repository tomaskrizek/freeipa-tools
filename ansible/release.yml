---
- hosts: release_machine
  vars_files:
    - vars/version.yml
    - vars/git.yml
    - vars/other.yml
  vars_prompt:
    - name: version_major
      prompt: "MAJOR version to release (MAJOR.minor.patch)"
      private: false
    - name: version_minor
      prompt: "MINOR version to release (major.MINOR.patch)"
      private: false
    - name: version_patch
      prompt: "PATCH version to release (major.minor.PATCH)"
      private: false
    - name: prev_version_major
      prompt: "Previous MAJOR version (MAJOR.minor.patch)"
      private: false
    - name: prev_version_minor
      prompt: "Previous MINOR version (major.MINOR.patch)"
      private: false
    - name: prev_version_patch
      prompt: "Previous PATCH version (major.minor.PATCH)"
      private: false
  roles:
    - role: version/confirm
      tags: always
    - role: git/clone
      git_repo_remove: true
      git_version: "{{ git_branch }}"
    - git/configure
    - zanata/push
    - zanata/pull
    - git/rebase
    - contributors
    - version/set_version
    - role: version/set_git_snapshot
      version_git_snapshot: "no"
    - role: version/commit
      version_git_snapshot: "no"
    - git/tag
    - role: version/set_git_snapshot
      version_git_snapshot: "yes"
    - role: version/commit
      version_git_snapshot: "yes"
    - git/push
    - role: git/clone
      git_repo_remove: true
      git_version: "{{ version.tag }}"
    - git/configure
    - artifacts/prepare
    - tarball
    - fedora/spec_patch
    - pypi/make_wheels
    - role: pypi/upload
      tags: pypi
    - role: release_notes
      tags: pagure
